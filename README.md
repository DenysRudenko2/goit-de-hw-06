# HW-06: Spark Streaming + Kafka = –ê–ª–µ—Ä—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ üöÄ

## –©–æ —Ü–µ —Ä–æ–±–∏—Ç—å?

–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç—å –¥–∞—Ç—á–∏–∫–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —Ç–∞ –≤–æ–ª–æ–≥–æ—Å—Ç—ñ —ñ —Å—Ç–≤–æ—Ä—é—î –∞–ª–µ—Ä—Ç–∏ –∫–æ–ª–∏ —â–æ—Å—å –Ω–µ —Ç–∞–∫.

## –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç (5 —Ö–≤–∏–ª–∏–Ω)

### –ö—Ä–æ–∫ 1: –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–æ–ø—ñ–∫–∏ –≤ Kafka
```bash
python 0_create_topics.py
```

### –ö—Ä–æ–∫ 2: –ó–∞–ø—É—Å—Ç—ñ—Ç—å –í–°–ï –≤ –æ–∫—Ä–µ–º–∏—Ö —Ç–µ—Ä–º—ñ–Ω–∞–ª–∞—Ö

**–¢–µ—Ä–º—ñ–Ω–∞–ª 1 - –ü–µ—Ä—à–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∞—Ç—á–∏–∫—ñ–≤:**
```bash
python 1_sensor_data_generator.py
```

**–¢–µ—Ä–º—ñ–Ω–∞–ª 2 - –î—Ä—É–≥–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∞—Ç—á–∏–∫—ñ–≤:**
```bash
python 1_sensor_data_generator.py
```

**–¢–µ—Ä–º—ñ–Ω–∞–ª 3 - Spark –æ–±—Ä–æ–±–∫–∞:**
```bash
python 2_spark_streaming_processor.py
```

**–¢–µ—Ä–º—ñ–Ω–∞–ª 4 - –ü–µ—Ä–µ–≥–ª—è–¥ –∞–ª–µ—Ä—Ç—ñ–≤ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ):**
```bash
python 3_alert_consumer.py
```

### –ö—Ä–æ–∫ 3: –ß–µ–∫–∞–π—Ç–µ –∞–ª–µ—Ä—Ç–∏ (~30 —Å–µ–∫—É–Ω–¥)

Spark –∑–±–∏—Ä–∞—î –¥–∞–Ω—ñ —É –≤—ñ–∫–Ω–∞—Ö –ø–æ 30 —Å–µ–∫—É–Ω–¥ —ñ –≥–µ–Ω–µ—Ä—É—î –∞–ª–µ—Ä—Ç–∏.

---

## –°–∫—Ä—ñ–Ω—à–æ—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è üì∏

### 1. –î–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ –ø—Ä–∞—Ü—é—é—Ç—å –æ–¥–Ω–æ—á–∞—Å–Ω–æ

![Multiple Generators](screenshots/03_multiple_generators.png)

**–©–æ –±–∞—á–∏–º–æ:** –î–≤–∞ —Ç–µ—Ä–º—ñ–Ω–∞–ª–∏ –∑ —Ä—ñ–∑–Ω–∏–º–∏ Instance ID (952 —ñ 972) –≥–µ–Ω–µ—Ä—É—é—Ç—å –¥–∞–Ω—ñ –¥–∞—Ç—á–∏–∫—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

### 2. Spark Streaming –æ–±—Ä–æ–±–ª—è—î –¥–∞–Ω—ñ

![Spark Processing](screenshots/img.png)

**–©–æ –±–∞—á–∏–º–æ:** Spark –∞–≥—Ä–µ–≥—É—î –¥–∞–Ω—ñ —É –≤—ñ–∫–Ω–∞—Ö (window) —Ç–∞ –æ–±—á–∏—Å–ª—é—î —Å–µ—Ä–µ–¥–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∏ —ñ –≤–æ–ª–æ–≥–æ—Å—Ç—ñ.

### 3. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∞–ª–µ—Ä—Ç—ñ–≤

![Alert Generation](screenshots/img_1.png)

**–©–æ –±–∞—á–∏–º–æ:** –ö–æ–ª–∏ —Å–µ—Ä–µ–¥–Ω—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ > 38¬∞C, –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∞–ª–µ—Ä—Ç "It's too hot" –∑ –∫–æ–¥–æ–º 104.

### 4. –ê–ª–µ—Ä—Ç–∏ –≤ Kafka

![Kafka Alerts](screenshots/06_kafka_alerts_output.png)

**–©–æ –±–∞—á–∏–º–æ:** Consumer –≥—Ä—É–ø–∞ `alert_monitor_group` —á–∏—Ç–∞—î 53 –∞–ª–µ—Ä—Ç–∏ –∑ —Ç–æ–ø—ñ–∫—É `denys_rudenko_alerts`.

### 5. –î–µ—Ç–∞–ª—å–Ω–∏–π –≤–∏–≥–ª—è–¥ –∞–ª–µ—Ä—Ç—ñ–≤

![Alert Details](screenshots/img_3.png)

**–©–æ –±–∞—á–∏–º–æ:** –§–æ—Ä–º–∞—Ç–æ–≤–∞–Ω—ñ –∞–ª–µ—Ä—Ç–∏ –∑ —É—Å—ñ–º–∞ –¥–µ—Ç–∞–ª—è–º–∏ - —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –≤–æ–ª–æ–≥—ñ—Å—Ç—å, —á–∞—Å, –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

### 6. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤ Kafka Plugin

![Kafka Plugin View](screenshots/img_4.png)

**–©–æ –±–∞—á–∏–º–æ:** PyCharm Kafka plugin –ø–æ–∫–∞–∑—É—î —â–æ –∞–ª–µ—Ä—Ç–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ñ –≤ —Ç–æ–ø—ñ–∫.

---

## –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î? ü§î

### –ü–æ—Ç—ñ–∫ –¥–∞–Ω–∏—Ö:
```
–î–∞—Ç—á–∏–∫–∏ ‚Üí Kafka ‚Üí Spark Streaming ‚Üí –ê–ª–µ—Ä—Ç–∏ ‚Üí Kafka ‚Üí –°–ø–æ–∂–∏–≤–∞—á
         ‚Üì         ‚Üì                ‚Üì         ‚Üì
   sensor_data   –∞–≥—Ä–µ–≥–∞—Ü—ñ—è      —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è  alerts
```

### –©–æ —Ä–æ–±–∏—Ç—å –∫–æ–∂–µ–Ω —Ñ–∞–π–ª:

| –§–∞–π–ª | –©–æ —Ä–æ–±–∏—Ç—å | 
|------|-----------|
| `1_sensor_data_generator.py` | –Ü–º—ñ—Ç—É—î IoT –¥–∞—Ç—á–∏–∫–∏, —à–ª–µ –¥–∞–Ω—ñ –≤ Kafka |
| `2_spark_streaming_processor.py` | –ß–∏—Ç–∞—î –¥–∞–Ω—ñ, —Ä–∞—Ö—É—î —Å–µ—Ä–µ–¥–Ω—ñ, –≥–µ–Ω–µ—Ä—É—î –∞–ª–µ—Ä—Ç–∏ |
| `3_alert_consumer.py` | –ü–æ–∫–∞–∑—É—î –∞–ª–µ—Ä—Ç–∏ –∑ Kafka |
| `alerts_conditions.csv` | –£–º–æ–≤–∏ –¥–ª—è –∞–ª–µ—Ä—Ç—ñ–≤ (–∫–æ–ª–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —á–∏ –≤–æ–ª–æ–≥—ñ—Å—Ç—å –Ω–µ –û–ö) |

### –ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –≤—ñ–∫–æ–Ω:
- **–í—ñ–∫–Ω–æ**: 30 —Å–µ–∫—É–Ω–¥
- **–ó—Å—É–≤**: 10 —Å–µ–∫—É–Ω–¥  
- **Watermark**: 5 —Å–µ–∫—É–Ω–¥

### –¢–∏–ø–∏ –∞–ª–µ—Ä—Ç—ñ–≤:

| –ö–æ–¥ | –£–º–æ–≤–∞ | –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è |
|-----|-------|--------------|
| 101 | –í–æ–ª–æ–≥—ñ—Å—Ç—å < 30% | It's too dry |
| 102 | –í–æ–ª–æ–≥—ñ—Å—Ç—å > 70% | It's too wet |
| 103 | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ < 35¬∞C | It's too cold |
| 104 | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ > 38¬∞C | It's too hot |
| 105 | –í—Å–µ –≤ –Ω–æ—Ä–º—ñ | Normal conditions |

---

## –ü—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è üîß

### –ê–ª–µ—Ä—Ç–∏ –Ω–µ –∑'—è–≤–ª—è—é—Ç—å—Å—è?
- –ü–æ—á–µ–∫–∞–π—Ç–µ 30+ —Å–µ–∫—É–Ω–¥ (—Ä–æ–∑–º—ñ—Ä –≤—ñ–∫–Ω–∞)
- –ó–∞–ø—É—Å—Ç—ñ—Ç—å `test_extreme_generator.py` –¥–ª—è –µ–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤—Å—ñ 3 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –ø—Ä–∞—Ü—é—é—Ç—å

### –ë–∞—Ç—á—ñ –ø–æ—Ä–æ–∂–Ω—ñ?
- –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–µ—Ä—à–∏—Ö 30 —Å–µ–∫—É–Ω–¥
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∏ –ø—Ä–∞—Ü—é—é—Ç—å
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Spark

### –ü–æ–º–∏–ª–∫–∞ –∑ Kafka?
```bash
python 0_create_topics.py  # –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–æ–ø—ñ–∫–∏
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É üìÅ

```
hw-06/
‚îú‚îÄ‚îÄ configs.py                    # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Kafka
‚îú‚îÄ‚îÄ alerts_conditions.csv         # –£–º–æ–≤–∏ –∞–ª–µ—Ä—Ç—ñ–≤
‚îú‚îÄ‚îÄ alerts_conditions_demo.csv    # –î–µ–º–æ —É–º–æ–≤–∏ (–ª–µ–≥—à—ñ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)
‚îú‚îÄ‚îÄ 0_create_topics.py           # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–ø—ñ–∫—ñ–≤
‚îú‚îÄ‚îÄ 1_sensor_data_generator.py   # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –¥–∞–Ω–∏—Ö
‚îú‚îÄ‚îÄ 2_spark_streaming_processor.py # Spark –æ–±—Ä–æ–±–∫–∞
‚îú‚îÄ‚îÄ 3_alert_consumer.py          # –ü–µ—Ä–µ–≥–ª—è–¥ –∞–ª–µ—Ä—Ç—ñ–≤
‚îú‚îÄ‚îÄ test_extreme_generator.py    # –¢–µ—Å—Ç –∑ –µ–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
‚îî‚îÄ‚îÄ screenshots/                 # –°–∫—Ä—ñ–Ω—à–æ—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç ‚úÖ

–°–∏—Å—Ç–µ–º–∞ —É—Å–ø—ñ—à–Ω–æ:
1. ‚úÖ –ì–µ–Ω–µ—Ä—É—î –¥–∞–Ω—ñ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Ö –¥–∞—Ç—á–∏–∫—ñ–≤
2. ‚úÖ –ê–≥—Ä–µ–≥—É—î –¥–∞–Ω—ñ —É sliding windows
3. ‚úÖ –§—ñ–ª—å—Ç—Ä—É—î –∑–∞ —É–º–æ–≤–∞–º–∏ –∑ CSV —Ñ–∞–π–ª—É
4. ‚úÖ –ó–∞–ø–∏—Å—É—î –∞–ª–µ—Ä—Ç–∏ –≤ Kafka —Ç–æ–ø—ñ–∫
5. ‚úÖ –î–æ–∑–≤–æ–ª—è—î –º–æ–Ω—ñ—Ç–æ—Ä–∏—Ç–∏ –∞–ª–µ—Ä—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ

**–î–æ–º–∞—à–Ω—î –∑–∞–≤–¥–∞–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–æ!** üéâ